<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="roleHierarchyManageDAO">

    <resultMap id="roleHierarchy" type="or.sabang.mng.sec.rhm.service.RoleHierarchyManageVO">
        <result property="parntsRoleCode" column="PARNTS_ROLE"/>
        <result property="chldrnRoleCode" column="CHLDRN_ROLE"/>
    </resultMap>

    <select id="selectRoleHierarchyList" parameterType="or.sabang.mng.sec.rhm.service.RoleHierarchyManageVO" resultMap="roleHierarchy">
            SELECT PARNTS_ROLE, 
                   CHLDRN_ROLE
              FROM TN_FEIS_ROLES_HIERARCHY
             WHERE 1=1
            <if test="searchCondition == 0">AND
                PARNTS_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
                OR
                CHLDRN_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
            <if test="searchCondition == 1">AND
                PARNTS_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
            <if test="searchCondition == 2">AND
                CHLDRN_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
            LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

	<insert id="insertRoleHierarchy" parameterType="or.sabang.mng.sec.rhm.service.RoleHierarchyManage">
		
			INSERT INTO TN_FEIS_ROLES_HIERARCHY 
				  ( PARNTS_ROLE
				  , CHLDRN_ROLE )
		   VALUES ( #{parntsRoleCode}
			      , #{chldrnRoleCode})
		
	</insert>

	<delete id="deleteRole">
		
			DELETE FROM TN_FEIS_ROLES_HIERARCHY 
			 WHERE PARNTS_ROLE=#{parntsRoleCode}
			 AND CHLDRN_ROLE=#{chldrnRoleCode}
		
	</delete>

	<select id="selectRoleHierarchyListTotCnt" parameterType="or.sabang.mng.sec.rhm.service.RoleHierarchyManageVO" resultType="int">

			SELECT COUNT(*) totcnt
			FROM TN_FEIS_ROLES_HIERARCHY
			WHERE 1=1
			<if test="searchCondition == 0">AND
                PARNTS_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
                OR
                CHLDRN_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
            <if test="searchCondition == 1">AND
                PARNTS_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
            <if test="searchCondition == 2">AND
                CHLDRN_ROLE LIKE CONCAT('%' , #{searchKeyword}, '%')
            </if>
	</select>
</mapper>