<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="noticeManageDAO">

	<resultMap id="noticeList" type="or.sabang.mng.bbs.ntb.service.NoticeVO">
		<result property="bbsId" column="BBS_ID"/>
		<result property="nttId" column="NTT_ID"/>
		<result property="nttSj" column="NTT_SJ"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="rdcnt" column="RDCNT"/>
		<result property="parnts" column="PARNTSCTT_NO"/>
		<result property="replyAt" column="ANSWER_AT"/>		
		<result property="replyLc" column="ANSWER_LC"/>
		<result property="useAt" column="USE_AT"/>
		<result property="atchFileId" column="ATCH_FILE_ID"/>
		<result property="ntceBgnde" column="NTCE_BGNDE"/>
		<result property="ntceEndde" column="NTCE_ENDDE"/>
		<result property="sjBoldAt" column="SJ_BOLD_AT"/>
		<result property="noticeAt" column="NOTICE_AT"/>
		<result property="secretAt" column="SECRET_AT"/>
		<result property="commentCo" column="COMMENT_CO"/>
	</resultMap>
	
	<resultMap id="noticeDetail" type="or.sabang.mng.bbs.ntb.service.NoticeVO">
		<result property="bbsId" column="BBS_ID"/>
		<result property="nttId" column="NTT_ID"/>
		<result property="nttSj" column="NTT_SJ"/>	
		<result property="ntcrId" column="NTCR_ID"/>
		<result property="ntcrNm" column="NTCR_NM"/>
		<result property="nttNo" column="NTT_NO"/>
		<result property="nttCn" column="NTT_CN"/>
		<result property="password" column="PASSWORD"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="ntceBgnde" column="NTCE_BGNDE"/>
		<result property="ntceEndde" column="NTCE_ENDDE"/>
		<result property="rdcnt" column="RDCNT"/>
		<result property="useAt" column="USE_AT"/>
		<result property="atchFileId" column="ATCH_FILE_ID"/>
		<result property="parnts" column="PARNTSCTT_NO"/>
		<result property="replyAt" column="ANSWER_AT"/>		
		<result property="replyLc" column="ANSWER_LC"/>
		<result property="sortOrdr" column="SORT_ORDR"/>
		<result property="bbsTyCode" column="BBS_TY_CODE"/>
		<result property="replyPosblAt" column="REPLY_POSBL_AT"/>
		<result property="fileAtchPosblAt" column="FILE_ATCH_POSBL_AT"/>
		<result property="posblAtchFileNumber" column="ATCH_POSBL_FILE_NUMBER"/>
		<result property="bbsNm" column="BBS_NM"/>
		<result property="sjBoldAt" column="SJ_BOLD_AT"/>
		<result property="noticeAt" column="NOTICE_AT"/>
		<result property="secretAt" column="SECRET_AT"/>
	</resultMap>
	
	<!-- 공지사항 목록조회 -->
	<select id="selectNoticeList" resultMap="noticeList">
		<![CDATA[
			SELECT *
			FROM TN_FEIS_BBS 
			WHERE USE_AT = 'Y'
				AND BBS_ID = 'BBS_002'
		]]>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchKeyword)">		
		<if test="searchCondition == 0">	<![CDATA[ AND
	             (NTT_SJ LIKE CONCAT ('%', #{searchKeyword},'%') OR
	             NTT_CN LIKE CONCAT ('%', #{searchKeyword},'%') OR 
	             FRST_REGISTER_ID LIKE CONCAT ('%', #{searchKeyword},'%')) ]]>
	        </if>
	        <if test="searchCondition == 1">	<![CDATA[ AND
	             NTT_SJ LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
	        <if test="searchCondition == 2">	<![CDATA[ AND
	             NTT_CN LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
	        <if test="searchCondition == 3">	<![CDATA[ AND
	             FRST_REGISTER_ID LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
        </if>
        ORDER BY SORT_ORDR DESC, FRST_REGIST_PNTTM DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<!-- 공지사항 갯수조회 -->
	<select id="selectNoticeTotCnt" resultType="int">
		<![CDATA[
			SELECT
				COUNT(NTT_ID)
			FROM
				TN_FEIS_BBS 
			WHERE USE_AT = 'Y'
				AND BBS_ID = 'BBS_002'
		]]>
		<if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchKeyword)">
			<if test="searchCondition == 0">	<![CDATA[ AND
	             (NTT_SJ LIKE CONCAT ('%', #{searchKeyword},'%') OR
	             NTT_CN LIKE CONCAT ('%', #{searchKeyword},'%') OR 
	             FRST_REGISTER_ID LIKE CONCAT ('%', #{searchKeyword},'%')) ]]>
	        </if>
	        <if test="searchCondition == 1">	
	        	<![CDATA[ AND NTT_SJ LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
	        <if test="searchCondition == 2">	
	        	<![CDATA[ AND NTT_CN LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
	        <if test="searchCondition == 3">	
	        	<![CDATA[ AND FRST_REGISTER_ID LIKE CONCAT ('%', #{searchKeyword},'%') ]]>
	        </if>
        </if> 
	</select>
	
	<!-- 공지사항 조회수 증가 -->
	<update id="IncrsNoticeRdcnt" parameterType="or.sabang.mng.bbs.ntb.service.NoticeVO">
			UPDATE TN_FEIS_BBS SET 
				RDCNT = RDCNT + 1 
			WHERE NTT_ID = #{nttId}
 	</update>
	
	<!-- 공지사항 상세조회 -->
	<select id="selectNoticeDetail" resultMap="noticeDetail">
		SELECT * 
		FROM TN_FEIS_BBS 
		WHERE NTT_ID = #{nttId}
	</select>
	
	<!-- 공지사항 등록 -->
	<insert id="insertNotice" parameterType="or.sabang.mng.bbs.ntb.service.NoticeVO">
		<![CDATA[
			INSERT INTO TN_FEIS_BBS
			(BBS_ID, 
				NTT_SJ, 
				NTT_CN,  
			 	USE_AT,
				NOTICE_AT,
			 	FRST_REGISTER_ID,
			 	FRST_REGIST_PNTTM
			 )
			VALUES
			(#{bbsId}, 
				#{nttSj}, 
				#{nttCn},
				'Y',
				'Y',
			  	#{frstRegisterId}, 
			  	NOW()
			 ) 
		]]>
	</insert>
	
	<!-- 공지사항 수정 -->
	<update id="updateNotice" parameterType="or.sabang.mng.bbs.ntb.service.NoticeVO">
			UPDATE TN_FEIS_BBS SET 
				NTT_SJ = #{nttSj},
				NTT_CN = #{nttCn}, 
				LAST_UPDUSR_ID = #{lastUpdusrId},
				LAST_UPDT_PNTTM = NOW()
			WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<!-- 공지사항 삭제 -->
	<update id="deleteNotice" parameterType="or.sabang.mng.bbs.ntb.service.NoticeVO">
			UPDATE TN_FEIS_BBS SET 
				USE_AT = 'N', 
				LAST_UPDUSR_ID = #{lastUpdusrId},
				LAST_UPDT_PNTTM = NOW()
			WHERE BBS_ID = #{bbsId}
			AND NTT_ID = #{nttId}
 	</update>
 	
 	<!-- 메인페이지 공지사항 조회 -->
 	<select id="selectMainNoticeList" resultType="egovMap" parameterType="hashMap" >
 		SELECT *
			FROM TN_FEIS_BBS 
			WHERE USE_AT = 'Y'
				AND BBS_ID = 'BBS_002'
			ORDER BY NTT_ID DESC
			LIMIT 3;
 	</select>
</mapper>