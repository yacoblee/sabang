<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:50:41 KST 2016
	수정일                 수정자                          수정내용
  =========     =======    =================================================
 2017.11.07		이정은			날짜로 검색 시 시분초 추가
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="LoginLog">

	<!-- 로그인로그 맵 -->
	<resultMap id="LoginLogVO" type="or.sabang.mng.log.clg.service.LoginLog">
		<result property="logId" column="LOG_ID"/>
		<result property="creatDt" column="CREAT_DT"/>
		<result property="loginMthd" column="CONECT_MTHD"/>
		<result property="loginIp" column="CONECT_IP"/>
		<result property="loginId" column="CONECT_ID"/>
		<result property="loginNm" column="LOGIN_NM"/>
	</resultMap>

	<!-- 로그인 로그 등록 -->
	<insert id="logInsertLoginLog" parameterType="or.sabang.mng.log.clg.service.LoginLog">
		<![CDATA[
			INSERT INTO TH_FEIS_LOGINLOG
				( LOG_ID
				  , CONECT_MTHD
				  , CONECT_ID
				  , CONECT_IP
				  , ERROR_OCCRRNC_AT
				  , ERROR_CODE
				  , CREAT_DT )
			VALUES ( #{logId}
				  , #{loginMthd}
				  , #{loginId}
				  , #{loginIp}
				  , #{errOccrrAt}
				  , #{errorCode}
				  , NOW())
		]]>
		
	</insert>

	<!-- 로그인 로그 상세  조회 -->
	<select id="selectLoginLog" parameterType="or.sabang.mng.log.clg.service.LoginLog" resultMap="LoginLogVO">
			
			<![CDATA[
			SELECT 
				  a.LOG_ID
				, a.CREAT_DT
				, CASE
					  WHEN TRIM(a.CONECT_MTHD) = 'I' THEN '로그인'
					  WHEN TRIM(a.CONECT_MTHD) = 'O' THEN '로그아웃'
				  ELSE ''
				  END AS CONECT_MTHD
				, a.CONECT_IP
				, a.CONECT_ID
				, b.MBER_NM AS LOGIN_NM
			FROM
				TH_FEIS_LOGINLOG a
			LEFT OUTER JOIN TN_FEIS_GNRLMBER b
				ON a.CONECT_ID = b.ESNTL_ID
			WHERE 
				a.LOG_ID = #{logId}
			]]>
			
	</select>

	<!-- 로그인 로그 목록  조회 -->
	<select id="selectLoginLogInf" parameterType="or.sabang.mng.log.clg.service.LoginLog" resultMap="LoginLogVO">
			
			<![CDATA[
			SELECT 
				  a.LOG_ID
				, a.CREAT_DT
				, CASE
					  WHEN TRIM(a.CONECT_MTHD) = 'I' THEN '로그인'
					  WHEN TRIM(a.CONECT_MTHD) = 'O' THEN '로그아웃'
				  ELSE ''
				  END AS CONECT_MTHD
				, a.CONECT_IP
				, a.CONECT_ID
				, b.MBER_NM AS LOGIN_NM
			FROM
				TH_FEIS_LOGINLOG a
			LEFT OUTER JOIN TN_FEIS_GNRLMBER b
				ON a.CONECT_ID = b.ESNTL_ID
			WHERE 
				1 = 1
			]]>
			
		<if test="searchWrd != null and searchWrd != ''">
		<if test="searchCnd == 0">	<![CDATA[ AND
             (LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%'))
             OR
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 1">	<![CDATA[ AND
             LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 2">	<![CDATA[ AND
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%') ]]>
        </if>
        </if>
		<if test="searchBgnDe != null and searchBgnDe != ''">	<![CDATA[	AND
					a.CREAT_DT BETWEEN TO_TIMESTAMP(CONCAT(#{searchBgnDe},' 00:00:00'), 'YYYY-mm-dd HH24:MI:SS') 
														AND TO_TIMESTAMP(CONCAT(#{searchEndDe},' 23:59:59'), 'YYYY-mm-dd HH24:MI:SS') ]]>
		</if>		
			<![CDATA[	 ORDER BY a.CREAT_DT DESC ]]>
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 로그인 로그 총건수 -->
	<select id="selectLoginLogInfCnt" parameterType="or.sabang.mng.log.clg.service.LoginLog" resultType="java.lang.Integer">
		 
		 <![CDATA[
			SELECT COUNT(a.LOG_ID) as cnt
			FROM
				TH_FEIS_LOGINLOG a
			LEFT OUTER JOIN TN_FEIS_GNRLMBER b
				ON a.CONECT_ID = b.ESNTL_ID
			WHERE 
				1 = 1
		]]>
		
		<if test="searchWrd != null and searchWrd != ''">
		<if test="searchCnd == 0">	<![CDATA[ AND
             (LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%'))
             OR
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 1">	<![CDATA[ AND
             LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 2">	<![CDATA[ AND
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%') ]]>
        </if>
        </if>
		<if test="searchBgnDe != null and searchBgnDe != ''">	<![CDATA[	AND
					a.CREAT_DT BETWEEN TO_TIMESTAMP(CONCAT(#{searchBgnDe},' 00:00:00'), 'YYYY-mm-dd HH24:MI:SS') 
														AND TO_TIMESTAMP(CONCAT(#{searchEndDe},' 23:59:59'), 'YYYY-mm-dd HH24:MI:SS') ]]>
		</if>
	</select>
	
	<!-- 로그인 로그 조회 목록 엑셀저장 -->
	<select id="selectLoginLogExcel" parameterType="or.sabang.mng.log.clg.service.LoginLog" resultType="egovMap">
			
		SELECT 
			a.LOG_ID,
			TO_CHAR(a.CREAT_DT,'YYYY-MM-DD HH24:MI:SS') as CREAT_DT,
			CASE
				WHEN TRIM(a.CONECT_MTHD) = 'I' THEN '로그인'
				WHEN TRIM(a.CONECT_MTHD) = 'O' THEN '로그아웃'
			ELSE ''
			END AS CONECT_MTHD,
			a.CONECT_IP,
			a.CONECT_ID,
			b.MBER_NM AS LOGIN_NM
		FROM
			TH_FEIS_LOGINLOG A
		LEFT OUTER JOIN TN_FEIS_GNRLMBER B
			ON a.CONECT_ID = b.ESNTL_ID
		WHERE 
			1=1
		<if test="searchWrd != null and searchWrd != ''">
		<if test="searchCnd == 0">	<![CDATA[ AND
             (LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%'))
             OR
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 1">	<![CDATA[ AND
             LOWER(b.MBER_NM) LIKE LOWER(CONCAT ('%', #{searchWrd},'%')) ]]>
        </if>
        <if test="searchCnd == 2">	<![CDATA[ AND
             a.CONECT_IP LIKE CONCAT ('%', #{searchWrd},'%') ]]>
        </if>
        </if>
		<if test="searchBgnDe != null and searchBgnDe != ''">	<![CDATA[	AND
					a.CREAT_DT BETWEEN TO_TIMESTAMP(CONCAT(#{searchBgnDe},' 00:00:00'), 'YYYYMMDD HH24:MI:SS') 
														AND TO_TIMESTAMP(CONCAT(#{searchEndDe},' 23:59:59'), 'YYYYMMDD HH24:MI:SS') ]]>
		</if>		
			<![CDATA[	 ORDER BY a.CREAT_DT DESC ]]>
	</select>
</mapper>